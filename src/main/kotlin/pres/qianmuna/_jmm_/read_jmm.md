

# jmm （jsr133 规范）

    jmm 内存模型 
    抽象
    描述程序之间变量的访问规则（多线程） // 与 cpu 多级缓存 类似
    频闭掉底层内存访问 的差异
    
    
    线程
    cpu 调度 的 最小单位
    // 程序 执行的 载体
    
## jmm 数据 8原子操作

    lock    // 把变量标记线程独占
    unlock  // 释放
    read    // 把变量从主内存传输到工作内存
    load    // 放入 工作内存 副本
    use     // 变量传递给执行引擎 
    aassign // 赋值给工作内存变量
    store   // 传递给 主内存
    write   // 给主内存变量 赋值
    
## 三大特性
        
        可见性
            线程1 更改 的 数据 要被 去他线程 所获知
            // 是要被 其他线程 可见的
            // 线程 会 拷贝 一个 变量副本 到工作内存
            // 拷贝 过程 就是 经过了一次完整 原子操作
            
        原子性            
            
        有序性        
    
    
> volatile 轻量级同步

    可见性 //
    使线程 之间变量的修改可以感知
    
    // 实现原理
    
    cpu缓存一致性协议
    总线窥探
    
    汇编层 前 加 lock 前缀
    触发 底层缓存锁定机制（缓存一致性协议）/ 以前：（总线锁）
    
    总线锁 (旧的 以前的)：总线 锁定 访问的那一块内存
    锁住 总线 ， 其他的线程 全部阻塞
    效率低  
    
    
    缓存一致性协议
    MSI
    MESI（主流使用） // M 已修改 E 独占 S 共享 I 已失效
    //
    会阻止同时修改被两个以上处理器缓存的内存数据
    一个 写回之内存后 会导致其他 缓存 无效
    
    //提高 性能 
    // 相对  总线锁
    
    


        
    
    
    
    
    
    
    
    